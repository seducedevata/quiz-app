<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeX Rendering Test - Knowledge App</title>
    
    <!-- Enhanced MathJax Configuration (same as our app) -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                packages: {'[+]': ['noerrors', 'textmacros', 'ams', 'newcommand', 'mathtools']},
                tags: 'none',
                macros: {
                    degree: '^{\\circ}',
                    angstrom: '\\text{√Ö}',
                    celsius: '^{\\circ}\\text{C}',
                    kelvin: '\\text{K}',
                    joule: '\\text{J}',
                    kilojoule: '\\text{kJ}',
                    mol: '\\text{mol}',
                    electronvolt: '\\text{eV}',
                    meter: '\\text{m}',
                    nanometer: '\\text{nm}',
                    picometer: '\\text{pm}',
                    bohr: 'a_0'
                },
                formatError: function (jax, error) {
                    console.warn('MathJax error:', error.message);
                    return ['span', {style: 'font-family: monospace; color: #333;'}, jax.math];
                }
            },
            svg: {
                fontCache: 'global',
                displayAlign: 'left',
                displayIndent: '0'
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                typeset: false,
                ready() {
                    console.log('‚úÖ MathJax loaded and ready');
                    MathJax.startup.defaultReady();
                    window.mathJaxReady = true;
                }
            }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f8fafc;
        }
        
        .test-case {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
        }
        
        .test-case h3 {
            color: #1e40af;
            margin-top: 0;
        }
        
        .original {
            background: #fef3c7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #f59e0b;
        }
        
        .processed {
            background: #ecfdf5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #10b981;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <h1>üßÆ LaTeX Rendering Test - Knowledge App Style</h1>
    <p>Testing the same MathJax configuration used in the Knowledge App with complex mathematical expressions.</p>
    
    <div id="status" class="status">‚è≥ Waiting for MathJax to load...</div>
    
    <button class="test-button" onclick="testLaTeX()">üß™ Test LaTeX Rendering</button>
    <button class="test-button" onclick="clearTests()">üßπ Clear All</button>
    
    <div class="test-case">
        <h3>üî¨ Physics Expression (from your screenshot)</h3>
        <div class="original">
            <strong>Original:</strong> Consider a hydrogen atom in its ground state, with principal quantum number n = 1 and orbital angular momentum quantum number l = 0. Calculate the expectation value of the radial probability density for an electron in this atom using the formula: ‚ü®r‚ü© = 2/a‚ÇÄ ‚à´‚ÇÄ^‚àû r‚Å¥ e^(-2r/a‚ÇÄ) dr, where a0 is the Bohr radius (approximately 5.29 √ó 10^{-11} m).
        </div>
        <div class="processed" id="physics-result">
            <strong>Processed (Click Test to see):</strong>
        </div>
    </div>
    
    <div class="test-case">
        <h3>üåä Wave Function</h3>
        <div class="original">
            <strong>Original:</strong> œà(r) = 1/‚àöœÄ (a‚ÇÄ/r)^(3/2) e^(-r/a‚ÇÄ)
        </div>
        <div class="processed" id="wave-result">
            <strong>Processed:</strong>
        </div>
    </div>
    
    <div class="test-case">
        <h3>üî¢ Complex Integral</h3>
        <div class="original">
            <strong>Original:</strong> ‚à´ r |œà(r)|^2 d¬≥r
        </div>
        <div class="processed" id="integral-result">
            <strong>Processed:</strong>
        </div>
    </div>
    
    <div class="test-case">
        <h3>‚öóÔ∏è Chemistry</h3>
        <div class="original">
            <strong>Original:</strong> The reaction H2 + O2 ‚Üí H2O releases 463 kJ/mol at T = 298 K
        </div>
        <div class="processed" id="chemistry-result">
            <strong>Processed:</strong>
        </div>
    </div>

    <script>
        // Our enhanced LaTeX processor function (same as in the app)
        function processLatexText(text) {
            if (!text) return text;

            console.log("üîß Processing LaTeX for:", text.substring(0, 100) + "...");

            // Protect existing LaTeX expressions
            const protectedLatex = [];
            let protectedIndex = 0;
            
            text = text.replace(/\$\$([^$]+)\$\$/g, (match, content) => {
                const placeholder = `__PROTECTED_DISPLAY_${protectedIndex++}__`;
                protectedLatex.push({ placeholder, content: `$$${content}$$` });
                return placeholder;
            });
            
            text = text.replace(/\$([^$]+)\$/g, (match, content) => {
                const placeholder = `__PROTECTED_INLINE_${protectedIndex++}__`;
                protectedLatex.push({ placeholder, content: `$${content}$` });
                return placeholder;
            });

            // Handle complex fractions with parentheses and exponents
            text = text.replace(/\(([a-zA-Z_0-9]+)\s*\/\s*([a-zA-Z_0-9]+)\)\s*\^\s*\(([^)]+)\)/g, '$$\\left(\\frac{$1}{$2}\\right)^{$3}$$');
            
            // Handle integrals
            text = text.replace(/‚à´\s*([^d]+)\s*d\s*([a-zA-Z])/g, '$$\\int $1 \\, d$2$$');
            text = text.replace(/‚à´‚ÇÄ\^‚àû/g, '$$\\int_0^{\\infty}$$');
            text = text.replace(/‚à´‚ÇÄ\^\‚àû/g, '$$\\int_0^{\\infty}$$');
            
            // Handle exponentials
            text = text.replace(/e\^(-([^)]+))/g, '$$e^{-$1}$$');
            text = text.replace(/e\^([^,\s\)]+)/g, '$$e^{$1}$$');
            
            // Handle fractions
            text = text.replace(/(\d+(?:\.\d+)?)\s*\/\s*([a-zA-Z_0-9]+)/g, '$$\\frac{$1}{$2}$$');
            text = text.replace(/([a-zA-Z_0-9]+)\s*\/\s*([a-zA-Z_0-9]+)/g, '$$\\frac{$1}{$2}$$');
            
            // Handle subscripts and superscripts
            text = text.replace(/([a-zA-Z])‚ÇÄ/g, '$1_0');
            text = text.replace(/([a-zA-Z])‚ÇÅ/g, '$1_1');
            text = text.replace(/([a-zA-Z])‚ÇÇ/g, '$1_2');
            text = text.replace(/([a-zA-Z])‚ÇÉ/g, '$1_3');
            text = text.replace(/([a-zA-Z])‚ÇÑ/g, '$1_4');
            
            text = text.replace(/([a-zA-Z0-9])¬≤/g, '$1^2');
            text = text.replace(/([a-zA-Z0-9])¬≥/g, '$1^3');
            text = text.replace(/([a-zA-Z0-9])‚Å¥/g, '$1^4');
            
            // Handle variables with subscripts
            text = text.replace(/\b([a-zA-Z])_([a-zA-Z0-9]+)\b/g, '$$\\ $1_{$2}$$');
            
            // Handle Greek letters
            text = text.replace(/œà/g, '$$\\psi$$');
            text = text.replace(/œÄ/g, '$$\\pi$$');
            text = text.replace(/‚àö/g, '$$\\sqrt$$');
            
            // Handle mathematical operators
            text = text.replace(/√ó/g, '$$\\times$$');
            text = text.replace(/‚àû/g, '$$\\infty$$');
            
            // Handle scientific notation
            text = text.replace(/(\d+(?:\.\d+)?)\s*[√óxX]\s*10\^([+-]?\d+)/g, '$$\\ $1 \\times 10^{$2}$$');
            
            // Handle units
            text = text.replace(/(\d+(?:\.\d+)?)\s*kJ\/mol/g, '$$\\ $1 \\text{ kJ/mol}$$');
            text = text.replace(/(\d+(?:\.\d+)?)\s*K\b/g, '$$\\ $1 \\text{ K}$$');
            text = text.replace(/(\d+(?:\.\d+)?)\s*m\b/g, '$$\\ $1 \\text{ m}$$');
            
            // Handle chemical formulas
            text = text.replace(/\bH2O\b/g, '$$\\text{H}_2\\text{O}$$');
            text = text.replace(/\bH2\b/g, '$$\\text{H}_2$$');
            text = text.replace(/\bO2\b/g, '$$\\text{O}_2$$');
            
            // Clean up
            text = text.replace(/\$\$\s*\$\$/g, '');
            text = text.replace(/\$\$([^$]*)\$\$\s*\$\$([^$]*)\$\$/g, '$$\\ $1 $2$$');
            text = text.replace(/\$\$\s*\$\$/g, '');
            text = text.replace(/\$\s*\$/g, '');
            
            // Restore protected LaTeX
            protectedLatex.forEach(({ placeholder, content }) => {
                text = text.replace(placeholder, content);
            });

            console.log("‚úÖ LaTeX processing completed");
            return text;
        }

        function updateStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
        }

        function testLaTeX() {
            if (!window.MathJax || !window.mathJaxReady) {
                updateStatus('‚ùå MathJax not ready yet, please wait...', 'error');
                return;
            }

            updateStatus('üß™ Testing LaTeX processing...', 'success');

            // Test cases
            const testCases = [
                {
                    id: 'physics-result',
                    text: "Consider a hydrogen atom in its ground state, with principal quantum number n = 1 and orbital angular momentum quantum number l = 0. Calculate the expectation value of the radial probability density for an electron in this atom using the formula: ‚ü®r‚ü© = 2/a‚ÇÄ ‚à´‚ÇÄ^‚àû r‚Å¥ e^(-2r/a‚ÇÄ) dr, where a0 is the Bohr radius (approximately 5.29 √ó 10^{-11} m)."
                },
                {
                    id: 'wave-result',
                    text: "œà(r) = 1/‚àöœÄ (a‚ÇÄ/r)^(3/2) e^(-r/a‚ÇÄ)"
                },
                {
                    id: 'integral-result',
                    text: "‚à´ r |œà(r)|^2 d¬≥r"
                },
                {
                    id: 'chemistry-result',
                    text: "The reaction H2 + O2 ‚Üí H2O releases 463 kJ/mol at T = 298 K"
                }
            ];

            testCases.forEach(({ id, text }) => {
                const element = document.getElementById(id);
                const processed = processLatexText(text);
                element.innerHTML = `<strong>Processed:</strong> ${processed}`;
            });

            // Render all LaTeX
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise().then(() => {
                    updateStatus('‚úÖ LaTeX rendering completed successfully!', 'success');
                }).catch(err => {
                    updateStatus(`‚ùå MathJax rendering failed: ${err.message}`, 'error');
                });
            }
        }

        function clearTests() {
            ['physics-result', 'wave-result', 'integral-result', 'chemistry-result'].forEach(id => {
                const element = document.getElementById(id);
                element.innerHTML = '<strong>Processed (Click Test to see):</strong>';
            });
            updateStatus('üßπ Tests cleared', 'success');
        }

        // Check MathJax loading
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.MathJax && window.mathJaxReady) {
                    updateStatus('‚úÖ MathJax loaded and ready for testing!', 'success');
                } else {
                    updateStatus('‚è≥ Still loading MathJax...', 'error');
                    // Keep checking
                    const checkInterval = setInterval(() => {
                        if (window.MathJax && window.mathJaxReady) {
                            updateStatus('‚úÖ MathJax loaded and ready for testing!', 'success');
                            clearInterval(checkInterval);
                        }
                    }, 500);
                }
            }, 1000);
        });
    </script>
</body>
</html>
